!function(e){function a(){c?(c=!1,e("div.ajaxUpload_Base.dragto .dragIndicator").addClass("fadeOut").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("fadeOut"),e(".ajaxUpload_Base").removeClass("dragto"),e("div.ajaxUpload_Base:not(.dragto)").each(function(a,i){0===e(this).children(".files").find(".file").length?!e(this).children(".placeHolder").hasClass("fadeIn")&&e(this).children(".placeHolder").is(":not(:visible)")&&e(this).children(".placeHolder").addClass("fadeIn").show().one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("fadeIn")}):!e(this).children(".placeHolder").hasClass("fadeOut")&&e(this).children(".placeHolder").is(":visible")&&e(this).children(".placeHolder").addClass("fadeOut").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("fadeOut"),e(this).hide()})})})):e("div.ajaxUpload_Base:not(.dragto)").length>0&&e("div.ajaxUpload_Base:not(.dragto)").each(function(a,i){0===e(this).children(".files").find(".file").length?!e(this).children(".placeHolder").hasClass("fadeIn")&&e(this).children(".placeHolder").is(":not(:visible)")&&e(this).children(".placeHolder").addClass("fadeIn").show().one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("fadeIn")}):!e(this).children(".placeHolder").hasClass("fadeOut")&&e(this).children(".placeHolder").is(":visible")&&e(this).children(".placeHolder").addClass("fadeOut").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("fadeOut"),e(this).hide()})})}var i=3236,n=document.getElementsByTagName("script"),t=n[n.length-1],o=t.src,d=o.substr(0,o.lastIndexOf("/")+1),l=d.replace("/script/","/"),r=window.navigator.userAgent,s=!1,c=!1,p={},f={},m=["jpg","jpeg","bmp","png","gif"];e(document).one("ajaxUpload:Setup",function(){function i(e){r.indexOf("MSIE ")>0&&document.documentMode<9&&!event.button&&(s=!1),1!==e.which||s||(e.which=0)}var n='<input type="file" class="ajaxUpload_hiddenFile" multiple></input>';e("body").append(n),e(document).on("dragenter",function(){e("div.ajaxUpload_Base:not(.dragto) .placeHolder").addClass("fadeOut").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("fadeOut"),e(this).hide()}),e(".ajaxUpload_Base").addClass("dragto"),c=!0}),e(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("drop.globaldrop",function(e){e.stopPropagation(),e.preventDefault(),a()}),e(document).mousedown(function(e){1===e.which&&(s=!0)}),e(document).mouseup(function(e){1===e.which&&(s=!1)}),e(document).mousemove(function(e){i(e),0===e.which&&a()})}),e.fn.ajaxUpload=function(n){function t(n){if(u.maxFiles>0&&n.length+h.children(".files").find(".file").length>u.maxFiles)return void alert(u.text_MaxFileCountExceeded.replace("[maxFiles]",u.maxFiles));for(var t=0;t<n.length;t++){var o=n[t].name.split(".").pop().toLowerCase();if(u.fileTypes.length>0&&e.inArray(o,u.fileTypes)===-1)return void alert(u.text_InvalidFileType.replace("[extension]",o));if(u.maxSize>0&&n[t].size>1024*u.maxSize)return void alert(u.text_MaxFileSizeExceeded.replace("[maxSize]",u.maxSize).replace("[filename]",n[t].name));var l=!1;if(u.preventDuplicates&&e.map(v,function(e){e.size===n[t].size&&e.filename===n[t].name&&(l=!0)}),l)return void alert(u.text_FileIsDuplicate.replace("[filename]",n[t].name));var c=u.fileIDPrefix+i;i++;var f=e('<div class="file" id="'+c+'" filetype="'+o+'"><a class="button_Remove">'+u.deleteText+'</a><div class="thumb"></div><span class="name">'+n[t].name+"</span></div>");u.description&&f.append('<textarea class="description" placeholder="'+u.text_DescriptionPlaceHolder+'"></textarea>'),""===u.deleteText&&f.children(".button_Remove").addClass("image"),v[c]={complete:!1,filename:n[t].name,size:n[t].size,data:{}},e(f).appendTo(h.children(".files:first")).addClass("fadeIn").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("fadeIn")}),a(),e.inArray(o,m)>-1?d(n[t],f.find("div.thumb"),function(e,a){a.css("background-image","url("+e+")")}):u.cssIcons||(o in p?f.children("div.thumb").css("background-image","url("+p[o]+")"):r(o)),s(n[t],c),h.trigger("ajaxUpload:FileAdd",[c,n[t]])}}function o(i){if("string"===e.type(i))i=h.children(".files").children(".file#"+i);else if("object"!==e.type(i))return void(u.debug&&console.log("ajaxUpload error: Type of input must be either object or string."));if(h.children(".files").children(".file#"+i.attr("id")).length>0){var n=e(i).attr("id");if(n in v){if(u.triggerCommandOnRemove){var t={};t[u.handler_CommandKey]=u.handler_removeCommand,t[u.handler_removeKey]=v[n].data[u.handler_removeSelector],e.ajax({url:u.uploadHandler,type:"POST",data:t})}delete v[n]}else f[n].abort();e(i).addClass("fadeOut").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).next(".file").length>0?e(this).next(".file").addClass("slideLeft").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("slideLeft"),e(i).remove(),h.trigger("ajaxUpload:FileRemove",[n,i]),a()}):(e(i).remove(),h.trigger("ajaxUpload:FileRemove",[n,i]),a())})}else u.debug&&console.log("File to be removed ("+i+") doesn't exist.")}function d(e,a,i){var n=new FileReader;n.onload=function(){i(n.result,a)},n.readAsDataURL(e)}function r(a){var i=l+"img/filetypes/icon_file_"+a+".png";e.ajax({url:i,type:"HEAD",success:function(){p[a]=i,h.children(".files").find("div.file").each(function(){e(this).children('div.file[filetype="'+a+'"] div.thumb').css("background-image","url("+p[a]+")")})}})}function s(a,i){var n=new FormData;n.append(u.handler_fileKey,a),n.append(u.handler_CommandKey,u.handler_uploadCommand),f[i]=e.ajax({xhr:function(){var a=e.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",function(e){var a=0,n=e.loaded||e.position,t=e.total;e.lengthComputable&&(a=Math.ceil(n/t*100)),c(a,i)},!1),a},url:u.uploadHandler,type:"POST",contentType:!1,processData:!1,cache:!1,data:n,success:function(n){a=e.parseJSON(n),"ok"===a.status&&h.find(".files #"+i).length>0?(h.find(".files #"+i+" div.progressBar").remove(),a.data.uploadFileName=h.find(".files #"+i).children("span.name").text(),v[i].complete=!0,v[i].data=a.data,h.find(".files #"+i).addClass("uploaded"),h.trigger("ajaxUpload:UploadComplete",[i,a])):"error"===a.status?(h.trigger("ajaxUpload:UploadError",[i,a,"expected","server",a.error]),u.debug&&console.log('ajaxUpload server side error: "'+a.error+'"'),h.find(".files #"+i).addClass("failed")):(h.trigger("ajaxUpload:UploadError",[i,a,"unexpected","server",n]),u.debug&&console.log('ajaxUpload unexpected server side input: "'+a.error+'"'),h.find(".files #"+i).addClass("failed"))},error:function(e,n,t){h.find(".files #"+i).addClass("failed"),"abort"!==t?(h.trigger("ajaxUpload:UploadError",[i,a,"unexpected","ajax",e.responseText,t]),u.debug&&console.log('ajaxUpload unexpected ajax error:\nResponse: "'+e.responseText+'" \nError: "'+t+'"')):(h.trigger("ajaxUpload:UploadAbort",[i,a]),u.debug&&console.log("ajaxUpload aborted. File: "+i))}})}function c(a,i){if(h.find(".files #"+i).length>0){if(h.find(".files #"+i).find("div.progressBar").length<1){var n=e('<div class="progressBar"><div class="progress"></div></div>');n.appendTo(h.find(".files #"+i))}var t=h.find(".files #"+i+" div.progressBar div.progress");t.css("width",a+"%")}}if(e(document).trigger("ajaxUpload:Setup"),this.length>1)return this.each(function(){e(this).ajaxUpload(n)}),this;var u=e.extend({debug:!0,fileTypes:[],uploadHandler:!1,preventDuplicates:!0,description:!0,formSelector:"",deleteText:"",maxFiles:10,maxSize:0,cssIcons:!0,allowDrop:!1,triggerCommandOnRemove:!0,injectType:"array",handler_CommandKey:"command",handler_uploadCommand:"ajaxUploadSingle",handler_removeCommand:"ajaxRemoveSingle",handler_removeKey:"fileToRemove",handler_removeSelector:"filename",handler_fileKey:"file",handler_DescriptionKey:"description",inputClass:"ajaxUpload_Input",formPrefix:"ajaxUpload_",formKeySeperator:"_",fileIDPrefix:"file",inputName_FileList:"files",text_DescriptionPlaceHolder:"Enter description here.",text_PlaceHolder:'<span class="centerdialog"><div class="addicon"></div>Add your files here...</span>',text_DropIndicator:'<span class="centerdialog">Yes, drop them up here...</span>',text_MaxFileCountExceeded:"You can't upload more than [maxFiles] files.",text_MaxFileSizeExceeded:"The file [filename] exceeds the maximum file size ([maxSize]kb).",text_InvalidFileType:'The file extension ".[extension]" is not permitted.',text_FileIsDuplicate:'The file "[filename]" already exists in the uploads list.'},n);u.allowDrop&&(e(document).off(".globaldrop"),e(document).on("drop.globaldrop",function(){a()}));var h=e(this),v={};h.addClass("ajaxUpload_Base"),u.cssIcons&&h.addClass("cssIcons"),u.uploadHandler||(u.uploadHandler=h.closest("form").attr("action")),""!==e.trim(h.html())&&(u.text_PlaceHolder=h.html()),h.html(""),h.on("drop",function(e){e.preventDefault();var a=e.originalEvent.dataTransfer.files;t(a)}),h.on("click",function(i){a(),i.target!==this&&!e(i.target).hasClass("files")&&!e(i.target).hasClass("ajaxUploadDialog")&&!e(i.target).parents(".ajaxUploadDialog").length>0||(e("input.ajaxUpload_hiddenFile").off(".clickuploader"),e("input.ajaxUpload_hiddenFile").one("change.clickuploader",function(){t(this.files)}),e("input.ajaxUpload_hiddenFile").click())}),h.on("click","a.button_Remove",function(){o(e(this).parent(".file"))});var x=!1;if(""===u.formSelector){if(!(e(h).closest("form").length>0))return void console.log("ajaxUpload Fatal Error: No forms found near the ajaxUpload object.");x=e(h).closest("form")}else{if(!(e(u.formSelector).length>0))return void console.log("ajaxUpload Fatal Error: Form selector \"'"+u.formSelector+'" not found.');x=e(u.formSelector)}x.on("submit",function(a){var i=e(this);i.find('input[type="hidden"].'+u.inputClass).remove(),a.preventDefault(),e.each(v,function(a,n){if(h.children(".files").children(".file#"+a).length>0&&n.complete){u.description&&(n.data[u.handler_DescriptionKey]=h.children(".files").children(".file#"+a).children("textarea.description").val());var t=e('<input class="'+u.inputClass+'" type="hidden" name="'+u.formPrefix+u.inputName_FileList+'[]" value="'+a+'" />');i.append(t),e.each(n.data,function(n,t){var o;o=e("indexed"===u.injectType?'<input class="'+u.inputClass+'" type="hidden" name="'+u.formPrefix+a+u.formKeySeperator+n+'" value="'+t+'" />':'<input class="'+u.inputClass+'" type="hidden" name="'+u.formPrefix+n+'[]" value="'+t+'" />'),i.append(o)})}})}),h.deleteFile=function(e){o(e)},h.files=function(){return v};var g='<div class="dragIndicator ajaxUploadDialog">'+u.text_DropIndicator+"</div>",j='<div class="placeHolder ajaxUploadDialog">'+u.text_PlaceHolder+"</div>",_='<div class="files"></div>';return h.append(_),h.append(j),h.append(g),h}}(jQuery);